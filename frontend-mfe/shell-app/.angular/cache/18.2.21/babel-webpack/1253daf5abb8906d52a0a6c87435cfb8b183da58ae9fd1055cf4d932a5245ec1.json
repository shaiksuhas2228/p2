{"ast":null,"code":"import { Subject } from 'rxjs';\nimport { Client } from '@stomp/stompjs';\nimport * as SockJS from 'sockjs-client';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let ChatService = /*#__PURE__*/(() => {\n  class ChatService {\n    constructor(http) {\n      this.http = http;\n      this.apiUrl = 'http://localhost:8088/api/chat';\n      this.stompClient = null;\n      this.messageSubject = new Subject();\n      this.messages$ = this.messageSubject.asObservable();\n      this.connect();\n    }\n    connect() {\n      this.stompClient = new Client({\n        webSocketFactory: () => new SockJS('http://localhost:8088/ws/chat'),\n        reconnectDelay: 5000,\n        heartbeatIncoming: 4000,\n        heartbeatOutgoing: 4000\n      });\n      this.stompClient.onConnect = () => {\n        console.log('WebSocket connected');\n      };\n      this.stompClient.onStompError = frame => {\n        console.error('WebSocket error:', frame);\n      };\n      this.stompClient.activate();\n    }\n    subscribeToMessages(username) {\n      if (this.stompClient) {\n        const doSubscribe = () => {\n          this.stompClient.subscribe(`/topic/messages/${username}`, message => {\n            const chatMessage = JSON.parse(message.body);\n            this.messageSubject.next(chatMessage);\n          });\n        };\n        if (this.stompClient.connected) {\n          doSubscribe();\n        } else {\n          this.stompClient.onConnect = () => {\n            console.log('WebSocket connected');\n            doSubscribe();\n          };\n        }\n      }\n    }\n    disconnect() {\n      if (this.stompClient) {\n        this.stompClient.deactivate();\n      }\n    }\n    sendMessage(receiverUsername, content, userId, senderUsername) {\n      const params = userId ? {\n        currentUserId: userId.toString()\n      } : {};\n      return this.http.post(`${this.apiUrl}/send`, {\n        receiverUsername,\n        content,\n        senderUsername\n      }, {\n        params\n      });\n    }\n    getConversation(username, userId) {\n      const params = userId ? {\n        currentUserId: userId.toString()\n      } : {};\n      return this.http.get(`${this.apiUrl}/conversation/${username}`, {\n        params\n      });\n    }\n    markAsRead(username, userId) {\n      const params = userId ? {\n        currentUserId: userId.toString()\n      } : {};\n      return this.http.post(`${this.apiUrl}/mark-read/${username}`, {}, {\n        params,\n        responseType: 'text'\n      });\n    }\n    getChatContacts(userId) {\n      const params = userId ? {\n        userId: userId.toString()\n      } : {};\n      return this.http.get(`${this.apiUrl}/contacts`, {\n        params\n      });\n    }\n    getUnreadCount(username, userId) {\n      const params = userId ? {\n        currentUserId: userId.toString()\n      } : {};\n      return this.http.get(`${this.apiUrl}/unread-count/${username}`, {\n        params\n      });\n    }\n    deleteConversation(username, userId) {\n      const params = userId ? {\n        currentUserId: userId.toString()\n      } : {};\n      return this.http.delete(`${this.apiUrl}/conversation/${username}`, {\n        params,\n        responseType: 'text'\n      });\n    }\n    static {\n      this.ɵfac = function ChatService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ChatService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ChatService,\n        factory: ChatService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ChatService;\n})();","map":{"version":3,"names":["Subject","Client","SockJS","ChatService","constructor","http","apiUrl","stompClient","messageSubject","messages$","asObservable","connect","webSocketFactory","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","onConnect","console","log","onStompError","frame","error","activate","subscribeToMessages","username","doSubscribe","subscribe","message","chatMessage","JSON","parse","body","next","connected","disconnect","deactivate","sendMessage","receiverUsername","content","userId","senderUsername","params","currentUserId","toString","post","getConversation","get","markAsRead","responseType","getChatContacts","getUnreadCount","deleteConversation","delete","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\acer\\Downloads\\RevHubTeam7final_2\\RevHubTeam7final\\RevHub\\frontend-mfe\\shell-app\\src\\app\\core\\services\\chat.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, Subject } from 'rxjs';\nimport { Client, IMessage } from '@stomp/stompjs';\nimport * as SockJS from 'sockjs-client';\n\nexport interface ChatMessage {\n  id: string;\n  senderId: string;\n  senderUsername: string;\n  receiverId: string;\n  receiverUsername: string;\n  content: string;\n  timestamp: string;\n  read: boolean;\n  messageType: string;\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ChatService {\n  private apiUrl = 'http://localhost:8088/api/chat';\n  private stompClient: Client | null = null;\n  private messageSubject = new Subject<ChatMessage>();\n  public messages$ = this.messageSubject.asObservable();\n\n  constructor(private http: HttpClient) {\n    this.connect();\n  }\n\n  private connect() {\n    this.stompClient = new Client({\n      webSocketFactory: () => new SockJS('http://localhost:8088/ws/chat'),\n      reconnectDelay: 5000,\n      heartbeatIncoming: 4000,\n      heartbeatOutgoing: 4000\n    });\n\n    this.stompClient.onConnect = () => {\n      console.log('WebSocket connected');\n    };\n\n    this.stompClient.onStompError = (frame) => {\n      console.error('WebSocket error:', frame);\n    };\n\n    this.stompClient.activate();\n  }\n\n  subscribeToMessages(username: string) {\n    if (this.stompClient) {\n      const doSubscribe = () => {\n        this.stompClient!.subscribe(`/topic/messages/${username}`, (message: IMessage) => {\n          const chatMessage = JSON.parse(message.body);\n          this.messageSubject.next(chatMessage);\n        });\n      };\n      \n      if (this.stompClient.connected) {\n        doSubscribe();\n      } else {\n        this.stompClient.onConnect = () => {\n          console.log('WebSocket connected');\n          doSubscribe();\n        };\n      }\n    }\n  }\n\n  disconnect() {\n    if (this.stompClient) {\n      this.stompClient.deactivate();\n    }\n  }\n\n  sendMessage(receiverUsername: string, content: string, userId?: number, senderUsername?: string): Observable<ChatMessage> {\n    const params = userId ? { currentUserId: userId.toString() } : {};\n    return this.http.post<ChatMessage>(`${this.apiUrl}/send`, {\n      receiverUsername,\n      content,\n      senderUsername\n    }, { params });\n  }\n\n  getConversation(username: string, userId?: number): Observable<ChatMessage[]> {\n    const params = userId ? { currentUserId: userId.toString() } : {};\n    return this.http.get<ChatMessage[]>(`${this.apiUrl}/conversation/${username}`, { params });\n  }\n\n  markAsRead(username: string, userId?: number): Observable<string> {\n    const params = userId ? { currentUserId: userId.toString() } : {};\n    return this.http.post(`${this.apiUrl}/mark-read/${username}`, {}, { params, responseType: 'text' });\n  }\n\n  getChatContacts(userId?: number): Observable<any[]> {\n    const params = userId ? { userId: userId.toString() } : {};\n    return this.http.get<any[]>(`${this.apiUrl}/contacts`, { params });\n  }\n\n  getUnreadCount(username: string, userId?: number): Observable<number> {\n    const params = userId ? { currentUserId: userId.toString() } : {};\n    return this.http.get<number>(`${this.apiUrl}/unread-count/${username}`, { params });\n  }\n\n  deleteConversation(username: string, userId?: number): Observable<string> {\n    const params = userId ? { currentUserId: userId.toString() } : {};\n    return this.http.delete(`${this.apiUrl}/conversation/${username}`, { params, responseType: 'text' });\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}