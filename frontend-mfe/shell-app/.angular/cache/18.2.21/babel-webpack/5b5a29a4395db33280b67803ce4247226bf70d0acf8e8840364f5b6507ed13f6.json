{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let ProfileService = /*#__PURE__*/(() => {\n  class ProfileService {\n    constructor(http) {\n      this.http = http;\n      this.userApiUrl = 'http://localhost:8081/api/users';\n      this.followApiUrl = 'http://localhost:8084/api/follow';\n    }\n    getProfile(username) {\n      return this.http.get(`${this.userApiUrl}/${username}`);\n    }\n    getUserPosts(username) {\n      return this.http.get(`http://localhost:8082/api/posts/user/${username}`);\n    }\n    updateProfile(updates) {\n      return this.http.put(`${this.userApiUrl}/profile`, updates);\n    }\n    updateProfileWithFile(formData) {\n      const profileData = {};\n      // If no file, just send other data\n      if (!formData.has('profilePicture') || !(formData.get('profilePicture') instanceof File)) {\n        formData.forEach((value, key) => {\n          profileData[key] = value;\n        });\n        return this.http.put(`${this.userApiUrl}/profile`, profileData);\n      }\n      // Handle file upload with base64 conversion\n      return new Observable(observer => {\n        const file = formData.get('profilePicture');\n        const reader = new FileReader();\n        formData.forEach((value, key) => {\n          if (key !== 'profilePicture') {\n            profileData[key] = value;\n          }\n        });\n        reader.onload = () => {\n          profileData.profilePicture = reader.result;\n          this.http.put(`${this.userApiUrl}/profile`, profileData).subscribe({\n            next: result => {\n              observer.next(result);\n              observer.complete();\n            },\n            error: err => observer.error(err)\n          });\n        };\n        reader.onerror = () => {\n          observer.error(new Error('Failed to read file'));\n        };\n        reader.readAsDataURL(file);\n      });\n    }\n    getAllUsers() {\n      return this.http.get(`${this.userApiUrl}/all`);\n    }\n    followUser(username) {\n      const userStr = localStorage.getItem('user');\n      if (!userStr) {\n        throw new Error('User not authenticated');\n      }\n      try {\n        const currentUser = JSON.parse(userStr);\n        if (!currentUser.id) {\n          throw new Error('User not authenticated');\n        }\n        const headers = new HttpHeaders({\n          'X-User-Id': currentUser.id.toString()\n        });\n        return this.http.post(`${this.followApiUrl}/${username}`, {}, {\n          headers\n        });\n      } catch (e) {\n        throw new Error('Invalid user data');\n      }\n    }\n    unfollowUser(username) {\n      const userStr = localStorage.getItem('user');\n      if (!userStr) {\n        throw new Error('User not authenticated');\n      }\n      try {\n        const currentUser = JSON.parse(userStr);\n        const headers = new HttpHeaders({\n          'X-User-Id': currentUser.id.toString()\n        });\n        return this.http.delete(`${this.followApiUrl}/${username}`, {\n          headers\n        });\n      } catch (e) {\n        throw new Error('Invalid user data');\n      }\n    }\n    getFollowStatus(username) {\n      return this.http.get(`${this.followApiUrl}/status/${username}`);\n    }\n    getPendingFollowRequests() {\n      return this.http.get(`${this.followApiUrl}/requests`);\n    }\n    acceptFollowRequest(followId) {\n      return this.http.post(`${this.followApiUrl}/requests/${followId}/accept`, {});\n    }\n    rejectFollowRequest(followId) {\n      return this.http.post(`${this.followApiUrl}/requests/${followId}/reject`, {});\n    }\n    cancelFollowRequest(username) {\n      return this.http.delete(`${this.followApiUrl}/cancel/${username}`);\n    }\n    getFollowers(username) {\n      return this.http.get(`${this.followApiUrl}/${username}/followers`);\n    }\n    getFollowing(username) {\n      return this.http.get(`${this.followApiUrl}/${username}/following`);\n    }\n    removeFollower(username) {\n      const userStr = localStorage.getItem('user');\n      if (!userStr) {\n        throw new Error('User not authenticated');\n      }\n      try {\n        const currentUser = JSON.parse(userStr);\n        const headers = new HttpHeaders({\n          'X-User-Id': currentUser.id.toString()\n        });\n        return this.http.delete(`${this.followApiUrl}/remove/${username}`, {\n          headers\n        });\n      } catch (e) {\n        throw new Error('Invalid user data');\n      }\n    }\n    searchUsers(query) {\n      return this.http.get(`${this.userApiUrl}/search?query=${encodeURIComponent(query)}`);\n    }\n    static {\n      this.ɵfac = function ProfileService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || ProfileService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ProfileService,\n        factory: ProfileService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ProfileService;\n})();","map":{"version":3,"names":["HttpHeaders","Observable","ProfileService","constructor","http","userApiUrl","followApiUrl","getProfile","username","get","getUserPosts","updateProfile","updates","put","updateProfileWithFile","formData","profileData","has","File","forEach","value","key","observer","file","reader","FileReader","onload","profilePicture","result","subscribe","next","complete","error","err","onerror","Error","readAsDataURL","getAllUsers","followUser","userStr","localStorage","getItem","currentUser","JSON","parse","id","headers","toString","post","e","unfollowUser","delete","getFollowStatus","getPendingFollowRequests","acceptFollowRequest","followId","rejectFollowRequest","cancelFollowRequest","getFollowers","getFollowing","removeFollower","searchUsers","query","encodeURIComponent","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\acer\\Downloads\\RevHubTeam7final_2\\RevHubTeam7final\\RevHub\\frontend-mfe\\shell-app\\src\\app\\core\\services\\profile.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { Post } from './post.service';\r\n\r\nexport interface User {\r\n  id: number;\r\n  username: string;\r\n  email: string;\r\n  profilePicture?: string;\r\n  bio?: string;\r\n  isPrivate?: boolean;\r\n  createdDate: string;\r\n  followersCount?: number;\r\n  followingCount?: number;\r\n  followStatus?: string;\r\n}\r\n\r\nexport interface FollowRequest {\r\n  id: number;\r\n  follower: User;\r\n  following: User;\r\n  status: 'PENDING' | 'ACCEPTED';\r\n  createdDate: string;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ProfileService {\r\n  private userApiUrl = 'http://localhost:8081/api/users';\r\n  private followApiUrl = 'http://localhost:8084/api/follow';\r\n\r\n  constructor(private http: HttpClient) { }\r\n\r\n  getProfile(username: string): Observable<User> {\r\n    return this.http.get<User>(`${this.userApiUrl}/${username}`);\r\n  }\r\n\r\n  getUserPosts(username: string): Observable<Post[]> {\r\n    return this.http.get<Post[]>(`http://localhost:8082/api/posts/user/${username}`);\r\n  }\r\n\r\n  updateProfile(updates: { bio?: string; profilePicture?: string; isPrivate?: string }): Observable<User> {\r\n    return this.http.put<User>(`${this.userApiUrl}/profile`, updates);\r\n  }\r\n  \r\n  updateProfileWithFile(formData: FormData): Observable<User> {\r\n    const profileData: any = {};\r\n    \r\n    // If no file, just send other data\r\n    if (!formData.has('profilePicture') || !(formData.get('profilePicture') instanceof File)) {\r\n      formData.forEach((value, key) => {\r\n        profileData[key] = value;\r\n      });\r\n      return this.http.put<User>(`${this.userApiUrl}/profile`, profileData);\r\n    }\r\n    \r\n    // Handle file upload with base64 conversion\r\n    return new Observable<User>(observer => {\r\n      const file = formData.get('profilePicture') as File;\r\n      const reader = new FileReader();\r\n      \r\n      formData.forEach((value, key) => {\r\n        if (key !== 'profilePicture') {\r\n          profileData[key] = value;\r\n        }\r\n      });\r\n      \r\n      reader.onload = () => {\r\n        profileData.profilePicture = reader.result as string;\r\n        this.http.put<User>(`${this.userApiUrl}/profile`, profileData).subscribe({\r\n          next: result => {\r\n            observer.next(result);\r\n            observer.complete();\r\n          },\r\n          error: err => observer.error(err)\r\n        });\r\n      };\r\n      reader.onerror = () => {\r\n        observer.error(new Error('Failed to read file'));\r\n      };\r\n      reader.readAsDataURL(file);\r\n    });\r\n  }\r\n  \r\n  getAllUsers(): Observable<User[]> {\r\n    return this.http.get<User[]>(`${this.userApiUrl}/all`);\r\n  }\r\n\r\n  followUser(username: string): Observable<{message: string}> {\r\n    const userStr = localStorage.getItem('user');\r\n    if (!userStr) {\r\n      throw new Error('User not authenticated');\r\n    }\r\n    try {\r\n      const currentUser = JSON.parse(userStr);\r\n      if (!currentUser.id) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n      const headers = new HttpHeaders({ 'X-User-Id': currentUser.id.toString() });\r\n      return this.http.post<{message: string}>(`${this.followApiUrl}/${username}`, {}, { headers });\r\n    } catch (e) {\r\n      throw new Error('Invalid user data');\r\n    }\r\n  }\r\n\r\n  unfollowUser(username: string): Observable<{message: string}> {\r\n    const userStr = localStorage.getItem('user');\r\n    if (!userStr) {\r\n      throw new Error('User not authenticated');\r\n    }\r\n    try {\r\n      const currentUser = JSON.parse(userStr);\r\n      const headers = new HttpHeaders({ 'X-User-Id': currentUser.id.toString() });\r\n      return this.http.delete<{message: string}>(`${this.followApiUrl}/${username}`, { headers });\r\n    } catch (e) {\r\n      throw new Error('Invalid user data');\r\n    }\r\n  }\r\n\r\n  getFollowStatus(username: string): Observable<{status: string}> {\r\n    return this.http.get<{status: string}>(`${this.followApiUrl}/status/${username}`);\r\n  }\r\n\r\n  getPendingFollowRequests(): Observable<FollowRequest[]> {\r\n    return this.http.get<FollowRequest[]>(`${this.followApiUrl}/requests`);\r\n  }\r\n\r\n  acceptFollowRequest(followId: number): Observable<{message: string}> {\r\n    return this.http.post<{message: string}>(`${this.followApiUrl}/requests/${followId}/accept`, {});\r\n  }\r\n\r\n  rejectFollowRequest(followId: number): Observable<{message: string}> {\r\n    return this.http.post<{message: string}>(`${this.followApiUrl}/requests/${followId}/reject`, {});\r\n  }\r\n\r\n  cancelFollowRequest(username: string): Observable<{message: string}> {\r\n    return this.http.delete<{message: string}>(`${this.followApiUrl}/cancel/${username}`);\r\n  }\r\n\r\n  getFollowers(username: string): Observable<User[]> {\r\n    return this.http.get<User[]>(`${this.followApiUrl}/${username}/followers`);\r\n  }\r\n\r\n  getFollowing(username: string): Observable<User[]> {\r\n    return this.http.get<User[]>(`${this.followApiUrl}/${username}/following`);\r\n  }\r\n  \r\n  removeFollower(username: string): Observable<{message: string}> {\r\n    const userStr = localStorage.getItem('user');\r\n    if (!userStr) {\r\n      throw new Error('User not authenticated');\r\n    }\r\n    try {\r\n      const currentUser = JSON.parse(userStr);\r\n      const headers = new HttpHeaders({ 'X-User-Id': currentUser.id.toString() });\r\n      return this.http.delete<{message: string}>(`${this.followApiUrl}/remove/${username}`, { headers });\r\n    } catch (e) {\r\n      throw new Error('Invalid user data');\r\n    }\r\n  }\r\n  \r\n  searchUsers(query: string): Observable<User[]> {\r\n    return this.http.get<User[]>(`${this.userApiUrl}/search?query=${encodeURIComponent(query)}`);\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}